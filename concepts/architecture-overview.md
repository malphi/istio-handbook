---
authors: ["malphi"]
reviewers: [""]
---

# 架构解析

作为新一代 Service Mesh 产品的领航者，Istio 创新性的在原有网格产品的基础上，添加了控制平面这一结构，使得 Service Mesh 的产品形态更加完善。这也是为什么它被称作第二代 Service Mesh 的原因。在此之后，几乎所有的网格产品都以此为基础进行架构的设计。毫不夸张的说，Istio 作为 Service Mesh 领域的弄潮儿，引领了时代的潮流，这也从一个侧面印证了它一经推出就大红大紫的原因。下面我们就来看看它的架构组成。

## Istio 的架构组成

Istio 的架构由两部分组成，分别是数据平面（Data Plane）和控制平面（Control Plane）。

- 数据平面：由整个网格内的 sidecar 代理组成，这些代理以 sidecar 的形式部署和应用服务一起部署。每一个 sidecar 会接管进入和离开服务的流量，并配合控制平面的组件，完成流量控制等方面的功能。可以把数据平面看做是网格内 sidecar 代理的网络拓扑形态。
- 控制平面：顾名思义，就是控制和管理数据平面中的 sidecar 代理，完成配置的分发、服务发现、和授权鉴权等功能。架构中拥有控制平面的优势在于，可以统一的对数据平面进行管理。试想一下，如果没有它，你要对网格内的代理进行一个配置的更新操作，恐怕就不是一件轻松的事情了。这也正是为什么拥有控制平面的产品，对 Linkerd 这种第一代 Service Mesh 具有巨大竞争优势的原因。在 Istio 1.5 版本中，控制平面由原来分散的、独立部署的几个组件整合为一个单体结构 istiod，变成了一个单进程、多模块的形态。



![istio-architecture](../images/istio-mesh-arch.png) 

### 核心组件

下面我们简单的介绍一下 Istio 架构中几个核心组件的主要功能。

#### Envoy

Istio 的数据平面默认使用 Envoy 作为 sidecar 代理。Envoy 将自己定位与高性能的 sidecar 代理，本质上它是第一代 Service Mesh 产品。可以说，流量控制相关的绝大部分功能都是由 Envoy 提供的，主要包括三个部分：

- 路由、流量转移；
- 弹性能力：如超时重试、熔断等；
- 调试功能：如故障注入、流量镜像。

#### Pilot

Pilot 组件的主要功能是将路由规则等配置信息转换为 sidecar 可以识别的信息，并下发给数据平面。可以把它简单的理解为是一个配置分发器（dispatcher），它辅助 sidecar 完成流量控制相关的功能。

#### Citadel

Citadel 是 Istio 中专门负责安全的组件，内置有身份和证书管理功能，可以实现较为强大的授权和认证等操作。

#### Galley

Galley 是 Istio 1.1 版本中新增加的组件，其目的是将 Pilot 和底层平台（如 Kubernetes）进行解耦。它分担了原本 Pilot 的一部分功能，主要负责配置的验证、提取和处理等。

## Istio 的设计目标

## Istio 的架构变迁之旅

## 

接下来，我们会从控制平面和数据平面两方面，来详细介绍一下架构中各组件的主要功能和工作流程。